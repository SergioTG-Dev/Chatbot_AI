version: "3.1"
intents:
  - greet
  - goodbye
  - affirm
  - deny
  - mood_great
  - mood_unhappy
  - bot_challenge
  - consult_appointment
  - cancel_appointment
  - reschedule_appointment
  - check_appointment_status
  - help
  - stop
  - request_contact_info
  - request_hours
  - ask_faq:
      use_entities: []
  - faq_gcba
  - list_procedures
  - nlu_fallback
  - inform
  - report_emergency
  - provide_dni
  - modify
  - solicitar_tramite
  - informar_dni
  - informar_nombre
  - informar_email

entities:
  - date
  - time
  - appointment_id
  - process_category
  - service_type
  - inquiry_topic
  - dni
  - first_name
  - last_name
  - email
  - department_id
  - procedure_id
  - appointment_request

slots:
  date:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: date

  time:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: time

  appointment_id:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: appointment_id
        
  process_category:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: process_category

  service_type:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: service_type

  inquiry_topic:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: inquiry_topic

  dni:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: dni

  first_name:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text

  last_name:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text

  email:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: appointment_full_form
            requested_slot: email
          - active_loop: appointment_form
            requested_slot: email

  nombre_completo:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: appointment_full_form
            requested_slot: nombre_completo
          - active_loop: appointment_form
            requested_slot: nombre_completo

  user_verified:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom
  appointment_request:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: appointment_request

  department_id:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: department_id
      - type: from_text

  procedure_id:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: procedure_id
      - type: from_text

  scheduled_at:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text

  turno_id:
    type: text
    influence_conversation: true
    mappings:
      - type: custom

  registration_needed:
    type: text
    influence_conversation: true
    mappings:
      - type: custom

  action_result:
    type: text
    influence_conversation: true
    mappings:
      - type: custom
              
forms:
  appointment_full_form:
    required_slots:
      - dni
      - nombre_completo
      - email
      - user_verified
      - department_id
      - procedure_id
      - scheduled_at
  appointment_form:
    required_slots:
      - dni
      - nombre_completo
      - email
      - user_verified
      - department_id
      - procedure_id
      - scheduled_at

responses:
  utter_greet:
  - text: "¬°Hola! Soy CiviBot, tu asistente de IA del Gobierno de la Ciudad de Buenos Aires. Te ayudo con tr√°mites, turnos y preguntas frecuentes."
  
  utter_goodbye:
  - text: "¬°Adi√≥s! Que tengas un buen d√≠a."
  
  utter_happy:
  - text: "¬°Genial!"
  
  utter_cheer_up:
  - text: "Aqu√≠ tienes algo para alegrarte."
  
  utter_iamabot:
  - text: "Soy un asistente de IA impulsado por Rasa."
  
  utter_faq_not_found:
    - text: "Lo siento, no tengo una respuesta exacta para esa pregunta."

  utter_did_that_help:
  - text: "¬øTe ayud√≥ esta informaci√≥n? ¬øNecitas algo m√°s?"

  # utter_ask_rephrase:
  # - text: "¬øPodr√≠as darme m√°s informaci√≥n?"

  utter_ask_service_type:
    - text: "¬øQu√© tipo de tr√°mite o servicio quieres reservar (ej. Renovaci√≥n de Licencia, Certificado M√©dico)?"

  utter_ask_date:
    - text: "¬øPara qu√© fecha te gustar√≠a agendar?"

  utter_ask_time:
    - text: "¬øY a qu√© hora ser√≠a tu cita?"

  utter_ask_dni:
    - text: "Por favor, indic√° tu DNI (solo n√∫meros)."

  utter_ask_nombre_completo:
    - text: "No encontr√© tu DNI. Indic√° tu nombre completo para registrarte."

  utter_ask_email:
    - text: "Por favor, indic√° tu correo electr√≥nico."

  utter_ask_department_id:
    - text: "Eleg√≠ el departamento del tr√°mite."

  utter_ask_procedure_id:
    - text: "Eleg√≠ el tr√°mite dentro del departamento seleccionado."

  utter_ask_scheduled_at:
    - text: "¬øQu√© fecha y hora quer√©s para el turno? (ej: 2025-11-01 10:30)"

  utter_confirm_found_data:
    - text: "He encontrado tus datos: DNI {dni}, Nombre {first_name} {last_name}, Correo {email}. ¬øSon correctos? (S√≠/No)"

  utter_ask_first_name:
    - text: "Para registrarte, indic√° tu nombre."

  utter_ask_last_name:
    - text: "Gracias. Ahora, tu apellido."

  utter_submit_appointment_form:
    - text: "Perfecto. He recolectado los datos. Tu cita de {service_type} para el {date} a las {time} est√° lista para ser agendada."

  utter_unclear:
    - text: "Disculpa, no entend√≠ bien. ¬øPodr√≠as reformular tu pregunta o pedir 'ayuda'?"
  
  utter_help:
    - text: "Soy tu asistente virtual, dispuesto a ayudarte en consultas, tramites o informaci√≥n que necesites de tu municipio"

  utter_contact_info:
    - text: "Puedes comunicarte al n√∫mero 4323-9400, su correo electr√≥nico es: j.mancino@gcba.gob.ar y el horario de atenci√≥n es de Lunes a Viernes de 7:30 a 13:30 Hs."

  utter_hours:
    - text: "Los horarios para x son de y"
  
  utter_ask_continue_form:
    - text: "Entendido, no pasa nada. ¬øQuieres intentar darnos la informaci√≥n ahora o prefieres cancelar la reserva?"

  utter_appointment_creation_failed:
    - text: "Lo siento, hubo un problema al intentar crear tu cita. Por favor, int√©ntalo m√°s tarde o comun√≠cate con soporte."

  utter_offer_alternate:
    - text: "¬øNecesitas realizar alg√∫n otro tr√°mite o consulta?"

  utter_confirm_cancellation:
    - text: "¬øEst√°s seguro de que deseas cancelar tu cita de {service_type} del {date}?"
  
  utter_reschedule_failed:
    - text: "No pudimos modificar tu reserva. Por favor, verifica el ID de la cita o int√©ntalo m√°s tarde."

  utter_emergency_contacts:
    - text: "üö® Para emergencias inmediatas:\n ü§ñ‚Ä¢ M√©dicas: 107 ‚Ä¢ Bomberos: 100 ‚Ä¢ Polic√≠a: 101 ‚Ä¢ Defensa Civil: 103"

  utter_ask_other_procedures:
    - text: "¬°Perfecto! Tu turno ha sido agendado exitosamente. ¬øNecesitas realizar alg√∫n otro tr√°mite?"
      buttons:
        - title: "S√≠, consultar tr√°mites"
          payload: "/ask_faq"
        - title: "No, gracias"
          payload: "/goodbye"

  utter_show_frequent_procedures:
    - text: "Estos son algunos de los tr√°mites m√°s frecuentes que puedes realizar:\n‚Ä¢ DNI (primera vez o renovaci√≥n)\n‚Ä¢ Pasaporte\n‚Ä¢ Licencia de conducir\n‚Ä¢ Certificados de nacimiento\n‚Ä¢ Consultas sobre impuestos (AGIP)\n‚Ä¢ Infracciones de tr√°nsito\n\n¬øSobre cu√°l te gustar√≠a obtener informaci√≥n?"

  utter_goodbye_after_appointment:
    - text: "¬°Perfecto! Tu turno est√° confirmado. ¬°Que tengas un excelente d√≠a y nos vemos pronto!"

  # 1. Pregunta de seguimiento que activa el loop
  utter_ask_another_consultation:
    - text: "¬øNecesitas realizar otra consulta?"
      buttons:
        - title: "S√≠, consultar tr√°mites"
          payload: "/ask_faq"
        - title: "No, finalizar"
          payload: "/goodbye"

  # 2. Respuesta informativa para "Turno" DENTRO del loop (sin activar el formulario)
  utter_turno_action_panel:
    - text: "En el panel de la izquierda Acciones R√°pidas puedes seleccionar Solicitar Turno para alguno de los siguientes tr√°mites: DNI / Pasaporte en Registro Civil, Permisos de Construcci√≥n en Obras, Licencias de Conducir y Multas, Impuestos y AGIP entre otros."

actions:
  - action_default_fallback
  - action_check_appointment
  - action_search_faq
  - action_list_procedures
  - action_submit_appointment_form
  - action_cancel_appointment
  - action_ask_new_reschedule_date
  - action_report_emergency
  - action_reschedule_appointment
  - action_despedida
  - action_start_registration
  - action_set_session_complete
  - action_respond_faq
  - action_verify_citizen
  - action_create_citizen
  - action_fetch_departments
  - action_fetch_procedures
  - action_book_appointment
  - action_detect_appointment_request